
# VOY Backend (Voice Of You)
[![Go Version](https://img.shields.io/badge/Go-1.21%2B-blue.svg)](https://golang.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

Бэкенд для платформы VOY (Voice Of You).

## Обзор
Этот репозиторий содержит код бэкенд-сервисов для платформы **VOY**, системы генерации персонализированного контента на основе голосового профиля пользователя. Бэкенд отвечает за:
- Аутентификацию и управление пользователями (регистрация, вход, выход)
- Управление профилями пользователей и их голосовыми данными
- Генерацию контента на основе голосовых профилей
- Хранение и управление созданными постами

**Технологический стек:**
- **Язык:** Go (Golang)
- **Веб-фреймворк:** Gin
- **База данных:** PostgreSQL
- **ORM:** GORM
- **Документация API:** Swagger
- **Аутентификация:** JWT в куках
- **Логирование:** Zap
- **Конфигурация:** env

## Начало работы
### 1. Предварительные требования
- **Go:** Версия 1.21 или выше
- **PostgreSQL:** Версия 12 и выше

### 2. Настройка окружения
1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/opazdunTeam/VOY
   git checkout origin/develop
   cd backend
   ```

2. **Создайте и отредактируйте файлы конфигурации `.env`:**
   ```bash
   cp .env.example .env
   ```

### 3. Запуск приложения
1. **Установите зависимости Go:**
   ```bash
   go mod tidy
   go mod download
   ```

2. **Запуска LLM:**
   ```bash
   sudo docker run -d -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama
   sudo docker exec -it ollama ollama run llama3.2:3b
   ```

3. **Запустите сервисы:**
   ```bash
   # Auth Service
   go run auth-service/cmd/main.go
   ```
   ```bash
   # В другом терминале: Profile Service
   go run profile-service/cmd/main.go
   ```
   ```bash
   # В другом терминале: Orchestrator Service
   go run orchestrator-service/cmd/main.go
   ```

## Генерация докемунтации
   ```bash
   cd auth-service
   swag init -g cmd/main.go
   ```
   ```bash
   cd profile-service
   swag init -g cmd/main.go
   ```
   ```bash
   cd orchestrator-service
   swag init -g cmd/main.go
   ```

## Структура бекенда
```
backend/
├── auth-service/                # Сервис аутентификации
│   ├── cmd/                     # Точка входа сервиса
│   └── internal/                # Внутренний код сервиса
│       ├── dto/                 # Data Transfer Objects
│       ├── handlers/            # HTTP обработчики
│       ├── models/              # Модели данных
│       ├── repository/          # Репозитории для работы с БД
│       └── service/             # Бизнес-логика сервиса
│
├── profile-service/             # Сервис для работы с профилями
│   ├── cmd/                     # Точка входа сервиса
│   └── internal/                # Внутренний код сервиса
│       ├── dto/                 # Data Transfer Objects
│       ├── handlers/            # HTTP обработчики
│       ├── models/              # Модели данных
│       ├── repository/          # Репозитории для работы с БД
│       └── service/             # Бизнес-логика сервиса
│
├── orchestrator-service/        # Сервис оркестрации генерации контента
│   ├── cmd/                     # Точка входа сервиса
│   └── internal/                # Внутренний код сервиса
│       ├── dto/                 # Data Transfer Objects
│       ├── handlers/            # HTTP обработчики
│       ├── models/              # Модели данных
│       ├── repository/          # Репозитории для работы с БД
│       └── service/             # Бизнес-логика сервиса
│
├── pkg/                         # Общие компоненты для всех сервисов
│   ├── config/                  # Конфигурация приложения
│   ├── db/                      # Работа с базой данных
│   ├── logger/                  # Логирование
│   └── middleware/              # Middleware (CORS, Auth, etc.)
│
├── .env                         # Файл с переменными окружения
├── .gitignore                   # Игнорируемые файлы
├── go.mod                       # Файл управления зависимостями
└── go.sum                       # Контрольные суммы зависимостей
```

## Ключевые концепции и рабочие процессы

### Аутентификация
- **Регистрация:** Пользователь регистрируется, предоставляя email, пароль и полное имя. Пароль хешируется, создается запись в базе данных.
- **Вход:** Пользователь входит с email и паролем. При успешной авторизации создается сессия, генерируется JWT-токен, который сохраняется в куки.
- **Выход:** Деактивация текущей сессии пользователя, удаление куки с токеном.
- **Защищенные маршруты:** Используют middleware для проверки JWT-токена и валидность сессии.

### Профили пользователей
- Каждый пользователь имеет профиль с голосовыми данными (DNA Data).
- Голосовые данные используются для дальнейшей генерации контента.

### Генерация контента
1. Пользователь создает заметку (note) с оригинальным текстом.
2. Система использует голосовой профиль и заметку для генерации персонализированного поста.
3. Сгенерированный пост сохраняется в базе данных с возможностью дальнейшего редактирования или публикации.

## API документация

### Auth Service API

| Метод | Путь                    | Описание                                    |
|-------|--------------------------|--------------------------------------------|
| POST  | `/api/v1/auth/register` | Регистрация нового пользователя            |
| POST  | `/api/v1/auth/login`    | Вход пользователя                          |
| POST  | `/api/v1/auth/logout`   | Выход пользователя                         |
| GET   | `/api/v1/auth/me`       | Получение профиля текущего пользователя    |

### Profile Service API

| Метод | Путь                    | Описание                                    |
|-------|--------------------------|--------------------------------------------|
| GET   | `/api/v1/profile`       | Получение профиля пользователя              |
| PUT   | `/api/v1/profile`       | Обновление профиля пользователя             |

### Orchestrator Service API

| Метод  | Путь                          | Описание                                    |
|--------|-------------------------------|--------------------------------------------|
| POST   | `/api/v1/posts/generate`     | Генерация поста на основе заметки           |
| GET    | `/api/v1/posts`              | Получение списка постов пользователя         |
| GET    | `/api/v1/posts/:id`          | Получение поста по ID                       |
| DELETE | `/api/v1/posts/:id`          | Удаление поста                              |

## Дополнительная документация

Для более детальной информации по API каждого сервиса доступен Swagger UI:

- Auth Service: `http://localhost:8080/swagger/index.html`
- Profile Service: `http://localhost:8081/swagger/index.html`
- Orchestrator Service: `http://localhost:8082/swagger/index.html`

## Безопасность

- Пароли хешируются перед сохранением в базе данных
- JWT-токены используются для аутентификации
- CORS настроен для безопасного взаимодействия с фронтендом
- Сессии имеют ограниченный срок действия и могут быть отозваны

## Дальнейшее развитие

- Интеграция с AI-моделями для генерации контента
- Расширение функционала управления голосовыми профилями
- Улучшение оркестрации микросервисов
